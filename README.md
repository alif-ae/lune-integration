
## Example Mapping: Lean → Lune

The raw `.json` transaction data received from LeanTech can be found here:  
[leanTechExample.json](https://github.com/alif-ae/lune-integration/blob/main/leanTechExample.json)

Below details the mapping as per the Lune API reference:  
`POST {{host}}/api/v3/transaction/enrich?response-type=consumer`  
with Alif’s potential mapping of LeanTech transaction fields.

---

### Lean Transaction (sample)

```json
{
  "account_id": "2ca1381b-fdf4-411b-8a41-8ee995ab97c8",
  "transaction_id": "2eeb8e7c-93c3-4f32-a6ed-8d1cad6d578e",
  "transaction_information": "EMIRATES DRIVING INSTITUT DUBAI ARE",
  "credit_debit_indicator": "DEBIT",
  "amount": {
    "currency": "AED",
    "amount": 250.79
  },
  "transaction_mutability": "IMMUTABLE",
  "booking_date_time": "2024-08-30T00:00:00Z",
  "insights": {
    "description_cleansed": "EMIRATES DRIVING INSTITUT DUBAI ARE",
    "category": "RENT_AND_SERVICES",
    "category_confidence": 0.98
  },
  "status": "BOOKED",
  "value_date_time": "2024-08-30T00:00:00Z",
  "index": 0,
  "regional_data": {
    "standard": "ARE.LEAN.V1",
    "data": {
      "id": "2eeb8e7c-93c3-4f32-a6ed-8d1cad6d578e",
      "description": "EMIRATES DRIVING INSTITUT DUBAI ARE",
      "account_id": "2ca1381b-fdf4-411b-8a41-8ee995ab97c8",
      "amount": -250.79,
      "currency_code": "AED",
      "index": 0,
      "pending": false,
      "timestamp": "2024-08-30T00:00:00Z",
      "transaction_id": "2eeb8e7c-93c3-4f32-a6ed-8d1cad6d578e"
    }
  }
}
````

---

### Lune Payload (mapped)

```json
{
  "transactions": [
    {
      "customer_id": "cust_123",
      "account_id": "2ca1381b-fdf4-411b-8a41-8ee995ab97c8",
      "card_id": "card_2ca1381b",
      "merchant_name": "Emirates Driving Institut",
      "direction": "DEBIT",
      "transaction_id": "2eeb8e7c-93c3-4f32-a6ed-8d1cad6d578e",
      "is_self_transaction": false,
      "is_transfer": false,
      "amount": 250.79,
      "iso_currency_cd": "AED",
      "occurred_at": "2024-08-30T00:00:00Z",
      "mcc": "8299",
      "raw_description": "EMIRATES DRIVING INSTITUT DUBAI ARE",
      "merchant_id": "merch_emirates-driving-institut_are",
      "location": {
        "iso_country_cd": "ARE",
        "city": "Dubai",
        "address": "",
        "region": "",
        "postal_code": ""
      }
    }
  ]
}
```

---

### Field Mapping Table

| Lune Field                | Example Value (Lune Payload)           | Lean Source Field                     | Notes / Transform                                                                                                                                             |
| ------------------------- | -------------------------------------- | ------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `customer_id`             | `cust_123`                             | (not in Lean)                         | **Generated by Alif** – internal non-PII user ID                                                                                                              |
| `account_id`              | `2ca1381b-fdf4-411b-8a41-8ee995ab97c8` | `account_id`                          | Direct mapping                                                                                                                                                |
| `card_id`                 | `card_2ca1381b`                        | (not in Lean)                         | **Generated by Alif** – deterministic surrogate per card/account                                                                                              |
| `merchant_name`           | `Emirates Driving Institut`            | `insights.description_cleansed`       | Direct mapping, normalized                                                                                                                                    |
| `direction`               | `DEBIT`                                | `credit_debit_indicator`              | Direct mapping                                                                                                                                                |
| `transaction_id`          | `2eeb8e7c-93c3-4f32-a6ed-8d1cad6d578e` | `transaction_id`                      | Direct mapping                                                                                                                                                |
| `is_self_transaction`     | `false`                                | (not in Lean)                         | **Generated by Alif** – default unless internal transfer detected                                                                                             |
| `is_transfer`             | `false`                                | (not in Lean)                         | **Generated by Alif** – default unless external transfer detected                                                                                             |
| `amount`                  | `250.79`                               | `amount.amount`                       | Direct mapping                                                                                                                                                |
| `iso_currency_cd`         | `AED`                                  | `amount.currency`                     | Direct mapping                                                                                                                                                |
| `occurred_at`             | `2024-08-30T00:00:00Z`                 | `booking_date_time` (fallbacks)       | Direct mapping (date precedence logic applied)                                                                                                                |
| `mcc`                     | `8299`                                 | (not in Lean)                         | **Generated by Alif** – Lean does not provide MCC. Currently rule-based. **We are exploring potential enrichment options – would Lune provide MCC directly?** |
| `raw_description`         | `EMIRATES DRIVING INSTITUT DUBAI ARE`  | `transaction_information`             | Direct mapping                                                                                                                                                |
| `merchant_id`             | `merch_emirates-driving-institut_are`  | (not in Lean)                         | **Generated by Alif** – stable surrogate (slug/hash of merchant+country)                                                                                      |
| `location.iso_country_cd` | `ARE`                                  | Parsed from description/account       | **Generated by Alif** – defaulted to UAE if not parseable                                                                                                     |
| `location.city`           | `Dubai`                                | Parsed from `transaction_information` | **Generated by Alif** – heuristic text parsing                                                                                                                |
| `location.address`        | `""`                                   | (not in Lean)                         | **Generated by Alif** – blank                                                                                                                                 |
| `location.region`         | `""`                                   | (not in Lean)                         | **Generated by Alif** – blank                                                                                                                                 |
| `location.postal_code`    | `""`                                   | (not in Lean)                         | **Generated by Alif** – blank                                                                                                                                 |

---

### Conclusion (Proposal)

From LeanTech, we can reliably capture **core transaction details** such as account ID, transaction ID, raw description, amount, currency, debit/credit indicator, and dates.

However, Lune’s API requires fields like **MCC** and **merchant\_id** which Lean does not provide. 




